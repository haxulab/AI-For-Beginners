<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Pre-trained Networks and Transfer Learning - äººå·¥æ™ºèƒ½åˆå­¦è€…è¯¾ç¨‹</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Pre-trained Networks and Transfer Learning";
        var mkdocs_page_input_path = "lessons/4-ComputerVision/08-TransferLearning/README.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> äººå·¥æ™ºèƒ½åˆå­¦è€…è¯¾ç¨‹
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../README_chs/">è¯¾ç¨‹ä»‹ç»</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">è¯¾ç¨‹è®¾ç½®</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../0-course-setup/for-teachers_chs/">ç»™æ•™è‚²è€…</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../0-course-setup/how-to-run_chs/">å¦‚ä½•è¿è¡Œä»£ç </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../0-course-setup/setup_chs/">å¼€å§‹ä½¿ç”¨è¿™ä¸ªè¯¾ç¨‹</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">äººå·¥æ™ºèƒ½ç®€ä»‹</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../1-Intro/README_chs/">äººå·¥æ™ºèƒ½ç®€ä»‹</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../1-Intro/assignment_chs/">æ¸¸æˆå¼€å‘é©¬æ‹‰æ¾</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">çŸ¥è¯†è¡¨ç¤ºä¸ä¸“å®¶ç³»ç»Ÿ</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../2-Symbolic/README_chs/">çŸ¥è¯†è¡¨ç¤ºä¸ä¸“å®¶ç³»ç»Ÿ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../2-Symbolic/assignment_chs/">æ„å»ºä¸€ä¸ªæœ¬ä½“</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ç¥ç»ç½‘ç»œ</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../3-NeuralNetworks/README_chs/">ç¥ç»ç½‘ç»œä»‹ç»</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../3-NeuralNetworks/03-Perceptron/README_chs/">ç¥ç»ç½‘ç»œå…¥é—¨ï¼šæ„ŸçŸ¥å™¨</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../3-NeuralNetworks/04-OwnFramework/README_chs/">ç¥ç»ç½‘ç»œä»‹ç». å¤šå±‚æ„ŸçŸ¥å™¨</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../3-NeuralNetworks/05-Frameworks/README_chs/">ç¥ç»ç½‘ç»œæ¡†æ¶</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">è®¡ç®—æœºè§†è§‰</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../06-IntroCV/README_chs/">è®¡ç®—æœºè§†è§‰ç®€ä»‹</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >å·ç§¯ç¥ç»ç½‘ç»œ</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../07-ConvNets/CNN_Architectures_chs/">è‘—åçš„ CNN æ¶æ„</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../07-ConvNets/README_chs/">å·ç§¯ç¥ç»ç½‘ç»œ</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >è¿ç§»å­¦ä¹ </a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="README_chs/">é¢„è®­ç»ƒç½‘ç»œå’Œè¿ç§»å­¦ä¹ </a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="TrainingTricks_chs/">æ·±åº¦å­¦ä¹ è®­ç»ƒæŠ€å·§</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../09-Autoencoders/README_chs/">è‡ªåŠ¨ç¼–ç å™¨</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../10-GANs/README_chs/">ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../11-ObjectDetection/README_chs/">ç›®æ ‡æ£€æµ‹</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../12-Segmentation/README_chs/">åˆ†å‰²</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">è‡ªç„¶è¯­è¨€å¤„ç†</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../5-NLP/13-TextRep/README_chs/">å°†æ–‡æœ¬è¡¨ç¤ºä¸ºå¼ é‡</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../5-NLP/14-Embeddings/README_chs/">åµŒå…¥</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../5-NLP/15-LanguageModeling/README_chs/">è¯­è¨€å»ºæ¨¡</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../5-NLP/16-RNN/README_chs/">å¾ªç¯ç¥ç»ç½‘ç»œ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../5-NLP/17-GenerativeNetworks/README_chs/">ç”Ÿæˆç½‘ç»œ</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../5-NLP/18-Transformers/READMEtransformers_chs">æ³¨æ„æœºåˆ¶å’ŒTransformer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../5-NLP/19-NER/README_chs/">å‘½åå®ä½“è¯†åˆ«</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../5-NLP/20-LangModels/READMELargeLang_chs">é¢„è®­ç»ƒå¤§è¯­è¨€æ¨¡å‹</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">å…¶ä»–æŠ€æœ¯</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../6-Other/21-GeneticAlgorithms/README_chs/">é—ä¼ ç®—æ³•</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../6-Other/22-DeepRL/README_chs/">æ·±åº¦å¼ºåŒ–å­¦ä¹ </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../6-Other/23-MultiagentSystems/README_chs/">å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">AIä¼¦ç†</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../7-Ethics/README_chs/">é“å¾·ä¸è´Ÿè´£ä»»çš„äººå·¥æ™ºèƒ½</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">å¤šæ¨¡æ€ç½‘ç»œ</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../X-Extras/X1-MultiModal/README_chs/">å¤šæ¨¡æ€ç½‘ç»œ</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">äººå·¥æ™ºèƒ½åˆå­¦è€…è¯¾ç¨‹</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Pre-trained Networks and Transfer Learning</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="pre-trained-networks-and-transfer-learning">Pre-trained Networks and Transfer Learning</h1>
<p>Training CNNs can take a lot of time, and a lot of data is required for that task. However, much of the time is spent learning the best low-level filters that a network can use to extract patterns from images. A natural question arises - can we use a neural network trained on one dataset and adapt it to classify different images without requiring a full training process?</p>
<h2 id="pre-lecture-quiz"><a href="https://red-field-0a6ddfd03.1.azurestaticapps.net/quiz/108">Pre-lecture quiz</a></h2>
<p>This approach is called <strong>transfer learning</strong>, because we transfer some knowledge from one neural network model to another. In transfer learning, we typically start with a pre-trained model, which has been trained on some large image dataset, such as <strong>ImageNet</strong>. Those models can already do a good job extracting different features from generic images, and in many cases just building a classifier on top of those extracted features can yield a good result.</p>
<blockquote>
<p>âœ… Transfer Learning is a term you find in other academic fields, such as Education. It refers to the process of taking knowledge from one domain and applying it to another.</p>
</blockquote>
<h2 id="pre-trained-models-as-feature-extractors">Pre-Trained Models as Feature Extractors</h2>
<p>The convolutional networks that we have talked about in the previous section contained a number of layers, each of which is supposed to extract some features from the image, starting from low-level pixel combinations (such as horizontal/vertical line or stroke), up to higher level combinations of features, corresponding to things like an eye of a flame. If we train CNN on sufficiently large dataset of generic and diverse images, the network should learn to extract those common features.</p>
<p>Both Keras and PyTorch contain functions to easily load pre-trained neural network weights for some common architectures, most of which were trained on ImageNet images. The most often used ones are described on the <a href="../07-ConvNets/CNN_Architectures_chs/">CNN Architectures</a> page from the prior lesson. In particular, you may want to consider using one of the following:</p>
<ul>
<li><strong>VGG-16/VGG-19</strong> which are relatively simple models that still give good accuracy. Often using VGG as a first attempt is a good choice to see how transfer learning is working.</li>
<li><strong>ResNet</strong> is a family of models proposed by Microsoft Research in 2015. They have more layers, and thus take more resources.</li>
<li><strong>MobileNet</strong> is a family of models with reduced size, suitable for mobile devices. Use them if you are short in resources and can sacrifice a little bit of accuracy.</li>
</ul>
<p>Here are sample features extracted from a picture of a cat by VGG-16 network:</p>
<p><img alt="Features extracted by VGG-16" src="images/features.png" /></p>
<h2 id="cats-vs-dogs-dataset">Cats vs. Dogs Dataset</h2>
<p>In this example, we will use a dataset of <a href="https://www.microsoft.com/download/details.aspx?id=54765&amp;WT.mc_id=academic-77998-cacaste">Cats and Dogs</a>, which is very close to a real-life image classification scenario.</p>
<h2 id="exercise-transfer-learning">âœï¸ Exercise: Transfer Learning</h2>
<p>Let's see transfer learning in action in corresponding notebooks:</p>
<ul>
<li><a href="TransferLearningPyTorch.ipynb">Transfer Learning - PyTorch</a></li>
<li><a href="TransferLearningTF.ipynb">Transfer Learning - TensorFlow</a></li>
</ul>
<h2 id="visualizing-adversarial-cat">Visualizing Adversarial Cat</h2>
<p>Pre-trained neural network contains different patterns inside it's <em>brain</em>, including notions of <strong>ideal cat</strong> (as well as ideal dog, ideal zebra, etc.). It would be interesting to somehow <strong>visualize this image</strong>. However, it is not simple, because patterns are spread all over the network weights, and also organized in a hierarchical structure.</p>
<p>One approach we can take is to start with a random image, and then try to use <strong>gradient descent optimization</strong> technique to adjust that image in such a way, that the network starts thinking that it's a cat. </p>
<p><img alt="Image Optimization Loop" src="images/ideal-cat-loop.png" /></p>
<p>However, if we do this, we will receive something very similar to a random noise. This is because <em>there are many ways to make network think the input image is a cat</em>, including some that do not make sense visually. While those images contain a lot of patterns typical for a cat, there is nothing to constrain them to be visually distinctive.</p>
<p>To improve the result, we can add another term into the loss function, which is called <strong>variation loss</strong>. It is a metric that shows how similar neighboring pixels of the image are. Minimizing variation loss makes image smoother, and gets rid of noise - thus revealing more visually appealing patterns. Here is an example of such "ideal" images, that are classified as cat and as zebra with high probability:</p>
<table>
<thead>
<tr>
<th><img alt="Ideal Cat" src="images/ideal-cat.png" /></th>
<th><img alt="Ideal Zebra" src="images/ideal-zebra.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Ideal Cat</em></td>
<td><em>Ideal Zebra</em></td>
</tr>
</tbody>
</table>
<p>Similar approach can be used to perform so-called <strong>adversarial attacks</strong> on a neural network. Suppose we want to fool a neural network and make a dog look like a cat. If we take dog's image, which is recognized by a network as a dog, we can then tweak it a little but using gradient descent optimization, until the network starts classifying it as a cat:</p>
<table>
<thead>
<tr>
<th><img alt="Picture of a Dog" src="images/original-dog.png" /></th>
<th><img alt="Picture of a dog classified as a cat" src="images/adversarial-dog.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Original picture of a dog</em></td>
<td><em>Picture of a dog classified as a cat</em></td>
</tr>
</tbody>
</table>
<p>See the code to reproduce the results above in the following notebook:</p>
<ul>
<li><a href="AdversarialCat_TF.ipynb">Ideal and Adversarial Cat - TensorFlow</a></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Using transfer learning, you are able to quickly put together a classifier for a custom object classification task and achieve high accuracy. You can see that more complex tasks that we are solving now require higher computational power, and cannot be easily solved on the CPU. In the next unit, we will try to use a more lightweight implementation to train the same model using lower compute resources, which results in just slightly lower accuracy.</p>
<h2 id="challenge">ğŸš€ Challenge</h2>
<p>In the accompanying notebooks, there are notes at the bottom about how transfer knowledge works best with somewhat similar training data (a new type of animal, perhaps). Do some experimentation with completely new types of images to see how well or poorly your transfer knowledge models perform.</p>
<h2 id="post-lecture-quiz"><a href="https://red-field-0a6ddfd03.1.azurestaticapps.net/quiz/208">Post-lecture quiz</a></h2>
<h2 id="review-self-study">Review &amp; Self Study</h2>
<p>Read through <a href="TrainingTricks_chs/">TrainingTricks_chs.md</a> to deepen your knowledge of some other way to train your models.</p>
<h2 id="assignment"><a href="lab/README_chs/">Assignment</a></h2>
<p>In this lab, we will use real-life <a href="https://www.robots.ox.ac.uk/~vgg/data/pets/">Oxford-IIIT</a> pets dataset with 35 breeds of cats and dogs, and we will build a transfer learning classifier.</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
